---
import { asText } from '@prismicio/client';
import { Card, PrismicHtml } from '..';
import { fetchSingleDocumentByType } from '../../lib/prismic/queries';
import '../../styles/components/slices/planes-index.scss';

const { headline, description, items: planes = []} = Astro.props;

// planes.forEach(({plane}) => {
//   console.log(plane);
// });

// const planeIDs = planes.map(({ id }) => id);

// const pilots = await fetchRelatedDocumentsByTypeAndIDs({
// 	type: 'pilot',
//   linkedType: 'plane',
// 	ids: planeIDs,
// }) || [];

// console.log(pilots);
---

<section class="planes-index container">
  {!!headline?.length && (
    <h2 class="planes-index__title text-5">
      {asText(headline)}
    </h2>
  )}

  {!!description?.length && (
    <div class="planes-index__content">
      <PrismicHtml html={description} />
    </div>
  )}

  {!!planes.length && (
    <ul class="planes-index__list container--sm">
      {planes.map(({ url, data: plane }) => {
        const pilot = !!plane?.pilot?.data?.name?.length
          ? asText(plane.pilot.data.name)
          : 'Mystery Pilot';

        return (
          <li>
            <Card url={url} photo={plane?.photo}>
              <h3 class="text-1" slot="title">{asText(plane?.name)}</h4>
              <p class="text--1" slot="subtitle">Built by {pilot}</p>
            </Card>
          </li>
        );
      })}
    </ul>
  )}
</section>