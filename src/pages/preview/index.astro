---
import { PrismicPreview } from '../../layouts';
---

<script>
  import * as prismic from "@prismicio/client";

  const routes = [
    {
      type: "homepage",
      path: "/",
    },
    {
      type: "plane",
      path: "/planes/:uid",
    },
    {
      type: "custom_template",
      path: "/:uid",
    },
  ];

  const init = async () => {
    // THIS IS THE ONLY WORKING EXAMPLE I CAN GET TO WORK
    const client = prismic.createClient('https://paper-plane-olympics.cdn.prismic.io/api/v2', {
      accessToken: '[access-token]',
      routes,
    });

    const defaultURL = "/";

    // Something in here is breaking the preview function..
    const url = await client.resolvePreviewURL({
      linkResolver: ({ isBroken, type, uid }) => {
        if (isBroken) {
          return "/404";
        } else if (type === "custom_template") {
          // return `/preview/${uid}`;
          return `/${uid}`;
        }
        // else if (type === "plane") {
        //   return `/preview/plane/${uid}`;
        // }
        return defaultURL;
      },
      defaultURL,
    });

    window.location.replace(url);
  };

  init();
</script>

<PrismicPreview />
